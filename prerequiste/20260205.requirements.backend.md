# Product Requirements Document (PRD)

## Product Name
**Dual-Entry Accounting & Invoicing Service**  
**Version:** v1.0

---

## 1. Executive Summary

The Dual-Entry Accounting & Invoicing Service provides a **financial system of record** for all billable ride services delivered by transportation fleets. It records **ride-based charges and payments** using a **double-entry ledger model** and supports **on-demand invoice generation** at multiple frequencies.

This service is financially authoritative, while:
- Ride creation
- Fare calculation
- Payment processing

remain external to this service.

The system ensures:
- Accounting correctness
- Audit-ready financial records
- Flexible billing cycles (daily, weekly, monthly, or per ride)
- Clear traceability from ride → ledger → invoice → balance

---

## 2. Business Intent

### 2.1 Problem Statement

As the platform scales across organizations and individuals, there is a growing need for:
- Accurate receivables tracking
- Consolidated billing
- Clear outstanding balance visibility
- Enterprise-grade invoicing

Without a formal ledger:
- Billing logic becomes fragmented
- Manual reconciliation increases
- Audits become difficult
- Financial reporting becomes unreliable

---

### 2.2 Business Goals

- Establish a **double-entry accounting foundation**
- Support **multiple billing frequencies**
- Enable **self-service invoice generation**
- Maintain **immutable, traceable financial records**
- Prepare for future fleet-wise revenue reporting

---

### 2.3 Success Metrics

| Metric | Target |
|------|-------|
| Ledger accuracy | 100% |
| Duplicate charge incidents | 0 |
| Invoice generation latency | < 2 seconds |
| Ledger to invoice traceability | 100% |
| Tenant data leakage | 0 |

---

## 3. Scope of Work

### 3.1 In Scope

- Dual-entry ledger engine
- Account creation and management
- Ride service charge recording
- Payment recording
- Balance computation
- On-demand invoice generation
- Multi-frequency billing
- Multi-tenant isolation

---

### 3.2 Out of Scope

- Ride lifecycle management
- Fare calculation logic
- Payment gateway integration
- Tax handling (GST, VAT, etc.)
- Manual adjustments or credits
- Fleet payouts

---

## 4. Core Concepts

### 4.1 Account

Represents the financially responsible entity.

**Account Types**
- Organization (Rehab Centers, Medical Facilities, Hospitals, Old Age Homes)
- Individual (Passenger, Guardian, Relative)

Each account owns:
- A ledger
- A balance
- Invoice history

---

### 4.2 Currency

- Single currency per tenant
- USD only
- No currency conversion required

---

### 4.3 Ledger (Double Entry)

The ledger follows double-entry accounting:
- Every transaction produces two ledger entries
- Total debits must always equal total credits

Ledger characteristics:
- Append-only
- Immutable
- Fully auditable

---

## 5. Functional Requirements

### 5.1 Account Management

**FR-1: Create Account**
- System shall allow creation of an account
- Required fields:
  - Account ID
  - Account Name
  - Account Type (Organization or Individual)
  - Status (Active or Inactive)
- Currency is fixed to USD

**FR-2: Account Ledger**
- Each account shall have its own ledger
- Ledger entries cannot be modified or deleted

---

### 5.2 Ride Service Charge Recording

**FR-3: Record Ride Charge**

Triggered after ride completion and fare calculation.

**Input**
- Ride ID
- Account ID
- Fare Amount (USD)
- Service Date
- Fleet ID (metadata)

**Ledger Entries**

| Ledger Account | Debit | Credit |
|--------------|------|-------|
| Accounts Receivable | Fare | — |
| Service Revenue | — | Fare |

**FR-4: Ride Idempotency**
- Same Ride ID cannot be posted more than once per account

---

### 5.3 Payment Recording

**FR-5: Record Payment Received**

Triggered by external payment confirmation.

**Input**
- Payment Reference ID
- Account ID
- Amount
- Payment Date
- Payment Mode (optional)

**Ledger Entries**

| Ledger Account | Debit | Credit |
|--------------|------|-------|
| Cash / Bank | Amount | — |
| Accounts Receivable | — | Amount |

**FR-6: Partial and Advance Payments**
- System must support partial and over-payments
- Account balance may be positive, zero, or negative

---

### 5.4 Balance and Statements

**FR-7: Balance Calculation**
```
Balance = Total Debits - Total Credits
```

**FR-8: Account Statement**
- Generate statements for any date range
- Include opening balance, transactions, and closing balance

---

### 5.5 Invoice Generation

**FR-9: Invoice Frequencies Supported**
- Per Ride
- Daily
- Weekly
- Monthly

**FR-10: On-Demand Invoice Generation**
- Input:
  - Account ID
  - Date range or explicit Ride IDs

**FR-11: Invoice Structure**
- Invoice number (unique per tenant)
- Account details
- Billing period
- Line items (Ride ID, service date, fare)
- Subtotal
- Payments applied
- Outstanding balance

**FR-12: Ledger Traceability**
- Every invoice line must reference ledger entry IDs

**FR-13: Invoice Immutability**
- Once generated, invoice is read-only

---

### 5.6 Multi-Tenant and Security

**FR-14: Tenant Isolation**
- Ledger data must be tenant-isolated

**FR-15: Audit Metadata**
Each ledger entry must store:
- Source type (Ride or Payment)
- Source reference ID
- Created timestamp
- Created by

---

## 6. Non-Functional Requirements

- Fixed-point monetary calculations
- Strong consistency
- Horizontally scalable reads
- Ledger append latency < 100ms
- Optimized invoice queries

---

## 7. Assumptions and Future Extensions

### Assumptions
- No tax handling
- No adjustments or credits
- USD only
- Ride and payment systems are upstream

### Future Extensions
- Fleet-wise revenue reporting
- Adjustments and credit notes
- Tax ledger entries
- ERP integrations

